<!-- NFT & Floor Price Query Tool: ç¶œåˆæŸ¥è©¢éŒ¢åŒ… NFT å’Œå¸‚å ´åœ°æ¿åƒ¹ -->
<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFT æ•¸æ“šæŸ¥è©¢ä¸­å¿ƒ</title>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ä½¿ç”¨ Inter å­—é«” */
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>

<body class="bg-gray-50 min-h-screen p-4 sm:p-8">

    <div class="max-w-6xl mx-auto space-y-12">
        <h1 class="text-4xl font-extrabold text-gray-900 text-center mb-10">NFT æ•¸æ“šæŸ¥è©¢ä¸­å¿ƒ</h1>

        <!-- è­¦å‘Šè¨Šæ¯å€åŸŸ -->
        <div id="alert-box" class="hidden max-w-4xl mx-auto p-4 text-sm rounded-lg" role="alert"></div>

        <!-- å€å¡Š 1: æŸ¥è©¢åœ°å€åä¸‹çš„æ‰€æœ‰ NFT (Alchemy) -->
        <div class="bg-white shadow-2xl rounded-xl p-6 md:p-10 border-t-4 border-blue-600">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <svg class="w-6 h-6 mr-3 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M3 10h18M7 15h1m4 0h1m-9 5h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z">
                    </path>
                </svg>
                1. éŒ¢åŒ… NFT æŸ¥è©¢ (Alchemy)
            </h2>
            <p class="text-gray-500 mb-4">è¼¸å…¥éŒ¢åŒ…åœ°å€ï¼ŒæŸ¥è©¢å…¶åœ¨ Ethereum ä¸»ç¶²æ“æœ‰çš„æ‰€æœ‰ NFTã€‚</p>

            <input type="text" id="address-input" placeholder="è«‹è¼¸å…¥éŒ¢åŒ…åœ°å€ (ä¾‹å¦‚: 0x...)"
                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 mb-4"
                value="0x5ac792f6b8c19958ed4dc2a7593c834a02470f1a">
            <button id="query-nft-button" onclick="fetchNFTs()"
                class="w-full bg-blue-600 text-white font-semibold py-3 rounded-lg shadow-md hover:bg-blue-700 transition duration-150 disabled:bg-gray-400">
                æŸ¥è©¢ NFT åˆ—è¡¨
            </button>

            <!-- çµæœé¡¯ç¤ºå€ -->
            <div class="mt-6">
                <h3 class="text-xl font-semibold text-gray-800 mb-4">æŸ¥è©¢çµæœ (<span id="nft-count">0</span> å€‹ NFT)</h3>
                <div id="results-nft-container" class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
                    <p id="placeholder-nft" class="text-gray-500 text-center py-4 col-span-full">é»æ“Šä¸Šæ–¹æŒ‰éˆ•é–‹å§‹æŸ¥è©¢ã€‚</p>
                </div>
            </div>
        </div>

        <!-- å€å¡Š 2: æŸ¥è©¢ NFT é›†åˆçš„åœ°æ¿åƒ¹ (OpenSea) -->
        <div class="bg-white shadow-2xl rounded-xl p-6 md:p-10 border-t-4 border-purple-600">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <svg class="w-6 h-6 mr-3 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 8c1.657 0 3 .895 3 2s-1.343 2-3 2h-1c-1.657 0-3 .895-3 2s1.343 2 3 2h1a2 2 0 002-2v-4a2 2 0 00-2-2h-1z">
                    </path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18V6"></path>
                </svg>
                2. é›†åˆåœ°æ¿åƒ¹æŸ¥è©¢ (OpenSea)
            </h2>
            <p class="text-gray-500 mb-4">è¼¸å…¥ OpenSea é›†åˆçš„ Slug (ä¾‹å¦‚: *boredapeyachtclub*)ï¼ŒæŸ¥è©¢åœ°æ¿åƒ¹åŠçµ±è¨ˆæ•¸æ“šã€‚</p>

            <input type="text" id="slug-input" placeholder="è«‹è¼¸å…¥é›†åˆ Slug (ä¾‹å¦‚: boredapeyachtclub)"
                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500 mb-4"
                value="boredapeyachtclub">
            <button id="query-floor-button" onclick="fetchFloorPrice()"
                class="w-full bg-purple-600 text-white font-semibold py-3 rounded-lg shadow-md hover:bg-purple-700 transition duration-150 disabled:bg-gray-400">
                æŸ¥è©¢åœ°æ¿åƒ¹
            </button>

            <!-- çµæœé¡¯ç¤ºå€ -->
            <div id="results-floor-container" class="mt-6 p-4 bg-purple-50 border border-purple-200 rounded-lg hidden">
                <!-- åœ°æ¿åƒ¹çµæœå°‡æœƒæ’å…¥æ­¤è™• -->
            </div>
            <p id="placeholder-floor" class="text-gray-500 text-center py-4">é»æ“Šä¸Šæ–¹æŒ‰éˆ•é–‹å§‹æŸ¥è©¢ã€‚</p>
        </div>

    </div>

    <script>
        // ğŸš¨ğŸš¨ğŸš¨ é‡è¦æé†’ï¼šè«‹å°‡ YOUR_..._API_KEY æ›¿æ›ç‚ºæ‚¨è‡ªå·±çš„çœŸå¯¦ API Key ğŸš¨ğŸš¨ğŸš¨
        // 1. Alchemy Key (ç”¨æ–¼æŸ¥è©¢åœ°å€åä¸‹ NFT)
        const ALCHEMY_API_KEY = "YOUR_ALCHEMY_API_KEY";
        const ALCHEMY_BASE_URL = `https://eth-mainnet.g.alchemy.com/v2/${ALCHEMY_API_KEY}`;
        const ALCHEMY_ENDPOINT = `${ALCHEMY_BASE_URL}/getNftsForOwner/`;

        // 2. OpenSea Key (ç”¨æ–¼æŸ¥è©¢åœ°æ¿åƒ¹)
        const OPENSEA_API_KEY = "YOUR_OPENSEA_API_KEY";
        const OPENSEA_BASE_URL = "https://api.opensea.io/api/v2";

        // DOM å…ƒç´ 
        const addressInput = document.getElementById('address-input');
        const slugInput = document.getElementById('slug-input');
        const queryNftButton = document.getElementById('query-nft-button');
        const queryFloorButton = document.getElementById('query-floor-button');
        const resultsNftContainer = document.getElementById('results-nft-container');
        const resultsFloorContainer = document.getElementById('results-floor-container');
        const nftCountSpan = document.getElementById('nft-count');
        const alertBox = document.getElementById('alert-box');
        const placeholderNft = document.getElementById('placeholder-nft');
        const placeholderFloor = document.getElementById('placeholder-floor');

        // ----------------------------------------------------
        // è¼”åŠ©å‡½æ•¸ï¼šé¡¯ç¤ºå’Œéš±è—è­¦å‘Šè¨Šæ¯
        // ----------------------------------------------------

        function showAlert(message, type = 'error') {
            alertBox.textContent = message;
            alertBox.classList.remove('hidden', 'bg-red-100', 'text-red-700', 'bg-green-100', 'text-green-700', 'bg-yellow-100', 'text-yellow-700');

            if (type === 'error') {
                alertBox.classList.add('bg-red-100', 'text-red-700');
            } else if (type === 'success') {
                alertBox.classList.add('bg-green-100', 'text-green-700');
            } else {
                alertBox.classList.add('bg-yellow-100', 'text-yellow-700');
            }
            alertBox.classList.remove('hidden', 'mx-auto');
        }

        function hideAlert() {
            alertBox.classList.add('hidden');
        }

        // ----------------------------------------------------
        // åŠŸèƒ½ 1: æŸ¥è©¢éŒ¢åŒ…åœ°å€çš„æ‰€æœ‰ NFT (Alchemy)
        // ----------------------------------------------------

        async function fetchNFTs() {
            hideAlert();
            resultsNftContainer.innerHTML = '';
            nftCountSpan.textContent = '...';
            placeholderNft.classList.add('hidden');
            queryNftButton.disabled = true;
            queryNftButton.textContent = 'æŸ¥è©¢ä¸­...';

            const ownerAddress = addressInput.value.trim();

            if (!ownerAddress || !ownerAddress.startsWith('0x') || ownerAddress.length !== 42) {
                showAlert('NFT æŸ¥è©¢å¤±æ•—ï¼šè«‹è¼¸å…¥æœ‰æ•ˆçš„ Ethereum åœ°å€ (0x é–‹é ­ä¸”é•·åº¦ç‚º 42 å­—å…ƒ)ã€‚', 'error');
                nftCountSpan.textContent = '0';
                placeholderNft.classList.remove('hidden');
                placeholderNft.textContent = 'é»æ“Šä¸Šæ–¹æŒ‰éˆ•é–‹å§‹æŸ¥è©¢ã€‚';
                queryNftButton.disabled = false;
                queryNftButton.textContent = 'æŸ¥è©¢ NFT åˆ—è¡¨';
                return;
            }

            if (ALCHEMY_API_KEY === "YOUR_ALCHEMY_API_KEY") {
                showAlert('NFT æŸ¥è©¢éŒ¯èª¤ï¼šè«‹å…ˆå°‡ç¨‹å¼ç¢¼ä¸­çš„ ALCHEMY_API_KEY æ›¿æ›ç‚ºæ‚¨çš„çœŸå¯¦ Keyï¼', 'error');
                nftCountSpan.textContent = '0';
                placeholderNft.classList.remove('hidden');
                queryNftButton.disabled = false;
                queryNftButton.textContent = 'æŸ¥è©¢ NFT åˆ—è¡¨';
                return;
            }

            try {
                const url = `${ALCHEMY_ENDPOINT}?owner=${ownerAddress}&withMetadata=true&pageSize=9`; // é™åˆ¶ 9 å€‹ä»¥é¿å…çµæœéå¤š
                const response = await fetch(url);
                const data = await response.json();

                if (data.error) {
                    throw new Error(data.error.message || 'API æŸ¥è©¢å¤±æ•—ã€‚');
                }

                const nfts = data.ownedNfts || [];
                nftCountSpan.textContent = nfts.length;

                if (nfts.length === 0) {
                    placeholderNft.textContent = `åœ°å€ ${ownerAddress} åä¸‹æ²’æœ‰æ‰¾åˆ°ä»»ä½• NFTã€‚`;
                    placeholderNft.classList.remove('hidden');
                } else {
                    renderNFTCards(nfts);
                    placeholderNft.classList.add('hidden');
                }

                showAlert(`æˆåŠŸæŸ¥è©¢åˆ° ${nfts.length} å€‹ NFTã€‚`, 'success');

            } catch (error) {
                console.error("NFT æŸ¥è©¢ç™¼ç”ŸéŒ¯èª¤:", error);
                showAlert(`NFT æŸ¥è©¢å¤±æ•—ï¼š${error.message}. è«‹æª¢æŸ¥åœ°å€å’Œ Alchemy API Key æ˜¯å¦æ­£ç¢ºã€‚`);
                nftCountSpan.textContent = '0';
                placeholderNft.textContent = 'é»æ“Šä¸Šæ–¹æŒ‰éˆ•é–‹å§‹æŸ¥è©¢ã€‚';
                placeholderNft.classList.remove('hidden');
            } finally {
                queryNftButton.disabled = false;
                queryNftButton.textContent = 'æŸ¥è©¢ NFT åˆ—è¡¨';
            }
        }

        function renderNFTCards(nfts) {
            resultsNftContainer.innerHTML = ''; // æ¸…ç©ºèˆŠçµæœ
            nfts.forEach(nft => {
                const imageUrl = nft.media?.[0]?.gateway || 'https://placehold.co/200x200/eeeeee/333333?text=No+Image';
                const tokenId = parseInt(nft.id.tokenId, 16);

                const cardHtml = `
                    <div class="bg-gray-100 border border-gray-200 rounded-lg shadow-md overflow-hidden transition transform hover:scale-[1.02]">
                        <div class="h-48 overflow-hidden">
                            <img src="${imageUrl}" alt="${nft.title || 'NFT Image'}" class="w-full h-full object-cover" onerror="this.onerror=null;this.src='https://placehold.co/200x200/eeeeee/333333?text=No+Image'">
                        </div>
                        <div class="p-3">
                            <h4 class="text-sm font-bold text-blue-700 truncate" title="${nft.title || 'ç„¡æ¨™é¡Œ'}">${nft.title || 'ç„¡æ¨™é¡Œ'}</h4>
                            <p class="text-xs text-gray-600 mt-1">
                                <strong>Token ID:</strong> ${isNaN(tokenId) ? 'N/A' : tokenId}
                            </p>
                            <p class="text-xs text-gray-400 truncate" title="${nft.contract.address}">
                                åˆç´„: ${nft.contract.address.substring(0, 6)}...${nft.contract.address.substring(38)}
                            </p>
                        </div>
                    </div>
                `;
                resultsNftContainer.insertAdjacentHTML('beforeend', cardHtml);
            });
        }


        // ----------------------------------------------------
        // åŠŸèƒ½ 2: æŸ¥è©¢ NFT é›†åˆçš„åœ°æ¿åƒ¹ (OpenSea)
        // ----------------------------------------------------

        async function fetchFloorPrice() {
            hideAlert();
            resultsFloorContainer.classList.add('hidden');
            placeholderFloor.classList.add('hidden');
            queryFloorButton.disabled = true;
            queryFloorButton.textContent = 'æŸ¥è©¢ä¸­...';

            const collectionSlug = slugInput.value.trim();

            if (!collectionSlug) {
                showAlert('åœ°æ¿åƒ¹æŸ¥è©¢å¤±æ•—ï¼šè«‹è¼¸å…¥æœ‰æ•ˆçš„ OpenSea é›†åˆ Slug (ä¾‹å¦‚: boredapeyachtclub)ã€‚', 'error');
                placeholderFloor.classList.remove('hidden');
                queryFloorButton.disabled = false;
                queryFloorButton.textContent = 'æŸ¥è©¢åœ°æ¿åƒ¹';
                return;
            }

            if (OPENSEA_API_KEY === "YOUR_OPENSEA_API_KEY") {
                showAlert('åœ°æ¿åƒ¹æŸ¥è©¢éŒ¯èª¤ï¼šè«‹å…ˆå°‡ç¨‹å¼ç¢¼ä¸­çš„ OPENSEA_API_KEY æ›¿æ›ç‚ºæ‚¨çš„çœŸå¯¦ Keyï¼', 'error');
                placeholderFloor.classList.remove('hidden');
                queryFloorButton.disabled = false;
                queryFloorButton.textContent = 'æŸ¥è©¢åœ°æ¿åƒ¹';
                return;
            }

            try {
                // OpenSea V2 Stats API éœ€è¦ collection_slug
                const url = `${OPENSEA_BASE_URL}/collections/${collectionSlug}/stats`;

                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'X-API-KEY': OPENSEA_API_KEY,
                        'Accept': 'application/json'
                    }
                });

                if (!response.ok) {
                    let errorData = await response.json();
                    throw new Error(errorData.errors?.[0]?.message || `HTTP éŒ¯èª¤ï¼š${response.status}`);
                }

                const data = await response.json();

                if (!data.stats) {
                    throw new Error('æœªæ‰¾åˆ°é›†åˆçµ±è¨ˆæ•¸æ“šã€‚å¯èƒ½æ˜¯ Slug éŒ¯èª¤æˆ–é›†åˆä¸å­˜åœ¨ã€‚');
                }

                renderFloorPrice(collectionSlug, data.stats);
                resultsFloorContainer.classList.remove('hidden');
                showAlert(`æˆåŠŸæŸ¥è©¢é›†åˆ ${collectionSlug} çš„çµ±è¨ˆæ•¸æ“šã€‚`, 'success');

            } catch (error) {
                console.error("åœ°æ¿åƒ¹æŸ¥è©¢ç™¼ç”ŸéŒ¯èª¤:", error);
                resultsFloorContainer.classList.add('hidden');
                placeholderFloor.textContent = 'æŸ¥è©¢çµæœå°‡æœƒé¡¯ç¤ºåœ¨é€™è£¡ã€‚';
                placeholderFloor.classList.remove('hidden');
                showAlert(`åœ°æ¿åƒ¹æŸ¥è©¢å¤±æ•—ï¼š${error.message}. è«‹æª¢æŸ¥ Slug å’Œ OpenSea API Key æ˜¯å¦æ­£ç¢ºã€‚`);
            } finally {
                queryFloorButton.disabled = false;
                queryFloorButton.textContent = 'æŸ¥è©¢åœ°æ¿åƒ¹';
            }
        }

        function formatEth(value) {
            if (typeof value !== 'number') return 'N/A';
            return (value / 1e18).toFixed(4); // å‡è¨­å–®ä½ç‚º weiï¼Œè½‰æ›ç‚º ETH
        }

        function renderFloorPrice(slug, stats) {
            resultsFloorContainer.innerHTML = `
                <h4 class="text-lg font-bold text-purple-700 mb-4">é›†åˆ Slug: ${slug}</h4>
                <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 text-center">
                    <!-- åœ°æ¿åƒ¹ -->
                    <div class="p-3 bg-white rounded-lg shadow-sm border border-purple-100">
                        <p class="text-xs text-gray-500">åœ°æ¿åƒ¹ (ETH)</p>
                        <p class="text-xl font-extrabold text-purple-800 mt-1">${stats.floor_price ? stats.floor_price.toFixed(3) : 'N/A'}</p>
                    </div>
                    <!-- ç¸½æˆäº¤é‡ -->
                    <div class="p-3 bg-white rounded-lg shadow-sm border border-purple-100">
                        <p class="text-xs text-gray-500">ç¸½æˆäº¤é‡ (ETH)</p>
                        <p class="text-xl font-extrabold text-purple-800 mt-1">${stats.total_volume ? stats.total_volume.toFixed(2) : 'N/A'}</p>
                    </div>
                    <!-- æŒæœ‰è€…æ•¸é‡ -->
                    <div class="p-3 bg-white rounded-lg shadow-sm border border-purple-100">
                        <p class="text-xs text-gray-500">æŒæœ‰è€…æ•¸é‡</p>
                        <p class="text-xl font-extrabold text-purple-800 mt-1">${stats.num_owners ? stats.num_owners.toLocaleString() : 'N/A'}</p>
                    </div>
                    <!-- ç¸½ä¾›æ‡‰é‡ -->
                    <div class="p-3 bg-white rounded-lg shadow-sm border border-purple-100">
                        <p class="text-xs text-gray-500">ç¸½ä¾›æ‡‰é‡</p>
                        <p class="text-xl font-extrabold text-purple-800 mt-1">${stats.total_supply ? stats.total_supply.toLocaleString() : 'N/A'}</p>
                    </div>
                </div>
            `;
        }

    </script>
</body>

</html>